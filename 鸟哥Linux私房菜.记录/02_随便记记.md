### 6.文件权限

在Linux里面，任何一个文件都具有“User, Group及Others”三种身份的个别权限。除此之外还有个“root”特殊角色。

Linux中所有的系统上的帐号与一般身份使用者，还有那个root的相关信息， 都是记录在/etc/passwd这个文件内。个人的密码则是记录在/etc/shadow这个文件下。，Linux所有的群组名称都记录在/etc/group内。

``su -``是切换到root用户的指令，``exit``即可退出root。



```shell
[root@study /]# ls -al
dr-xr-xr-x.  17 root root  224 9月   8 17:24 .
dr-xr-xr-x.  17 root root  224 9月   8 17:24 ..
lrwxrwxrwx.   1 root root    7 9月   8 17:21 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 9月   8 17:37 boot
drwxr-xr-x.  20 root root 3340 9月   9 12:53 dev
drwxr-xr-x. 144 root root 8192 9月   9 11:22 etc
drwxr-xr-x.   3 root root   17 9月   8 17:24 home
lrwxrwxrwx.   1 root root    7 9月   8 17:21 lib -> usr/lib
lrwxrwxrwx.   1 root root    9 9月   8 17:21 lib64 -> usr/lib64
drwxr-xr-x.   2 root root    6 4月  11 2018 media
```

上面代码中，lrwxrwxrwx这种是代表文件类型和文件权限的值，第一个字符是文件类型，剩下的字符三个一组"rwx"分别代表"文件拥有者", "群组", "其他人"三种用户对该文件的权限。

第一个字符：

1. 当为[ d ]则是目录；
2. 当为[ - ]则是文件；
3. 若是[ l ]则表示为链接文件（link file）；
4. 若是[ b ]则表示为设备文件里面的可供储存的周边设备（可随机存取设备）；
5. 若是[ c ]则表示为设备文件里面的序列埠设备，例如键盘、鼠标；
6. 若是[ s ]则表示为sockets文件；（后面再讲）
7. 若是[ p ]则表示为FIFO, pipe文件；（后面再讲）

PS：b是块设备文件，c是字符设备文件（例如鼠标，你不可能让鼠标“跳到”另一个画面，而是“连续性滑动”到另一个地方）

PS：目录和文件的权限意义不相同，目录的后面讲。



第二栏代表有多少文件名连接到此文件。第三栏是文件的拥有者，第四栏是群组，第五栏是文件大小(字节)，第六栏是文件创建日期或最近修改日期。最右边是文件名。

目录文件的如果[r--]，没有执行权限则无法进入此目录！

root非常特殊，即使文件的权限为[---------]，root也能存取这个文件。（最高权力）



#### 改变所属群组——chgrp

格式：``chgrp 目的群组名 文件名``

``-R``参数是指对目录下面的目录及文件也一同更改，一般用于改变整个目录权限时使用。



#### 改变文件拥有者——chown

格式：``chown 新账号[:群组名] 文件名``	改的时候可以顺便把群组也改了

chown也可以只改变群组名（加个小数点），``chown .群组名 文件名``



#### 改编权限——chmod

- 数字类型改变文件权限

  r是4，w是2，x1，如果是rwx就是4+2+1=7，如果是r-x就是4+1=5

  ```shell
  # 例如改为rwxrwxrwx，则
  chmod 777 文件名
  ```

- 符号类型改变文件权限

  u是拥有者，g是组，o是其他人，a是所有人，+是加权限，-是减权限，=是设置权限。

  ```shell
  # | chmod | u g o a | +（加入） -（除去） =（设置） | r w x | 文件或目录 |
  # 例如
  chmod u=rwx,go=rx 文件名
  ```

  

#### 目录文件的权限

对于目录文件来说，

- r表示读取目录结构清单的权限，可以查询该目录下的文件名数据。
- w表示具有异动该目录结构的权限，可以创建新文件/目录，可以删除，可以改名。
- x表示的是使用者能够进入该目录成为工作目录的用途。



如果一个用户对目录具有w权限，那么即使对目录中某个文件的权限是[---]，那么他也可以直接删除这个他完全无法利用的文件。

如果用户对一个目录只有x权限没有r权限，但用户知道这个目录有哪个文件，则该用户也可以直接对这个文件进行操作（把路径写出来就可）。

Linux的文件没有所谓"扩展名"，一个文件能否被执行只看是否有[x]的权限。

Linux文件长度限制，单一文件或目录的最大容许文件名为 255Bytes。



### 7.Linux目录配置

#### Linux目录配置的依据——FHS

目录类型：

- 可分享的，可以分享给其他系统挂载使用的目录，所以包括可执行文件与使用者的邮件等数据， 是能够分享给网络上其他主机挂载用的目录。
- 不可分享的，仅仅与自己机器有关的文件。
- 不变的，跟随着distribution而不变动。 例如函数库、文件说明文档。

- 可变动的，经常改变的数据，例如登录文件、一般用户可自行收受的新闻群组等。



FHS针对目录树架构仅定义出三层目录下面应该放置什么数据：

- / （root, 根目录）：与开机系统有关；
- /usr （unix software resource）：与软件安装/执行有关；
- /var （variable）：与系统运行过程有关。



#### 根目录(/)

不但所有的目录都是由根目录衍生出来的，同时根目录也与开机/还原/系统修复等动作有关。所以FHS建议：**根目录（/）所在分区应该越小越好**， 且应用程序所安装的软件最好不要与根目录放在同一个分区内，保持根目录越小越好。

FHS定义出根目录（/）下面**必须要有**的目录：

- /bin

  存放cat, chmod, chown, date, mv, mkdir, cp, bash等等常用的指令。

  /bin放置的是在单人维护模式下还能够被操作的指令。 在/bin下面的指令可以被root与一般
  帐号所使用。

- /boot

  存放开机要使用的文件，例如Linux核心文件、开机配置文件等。

- /dev

  存放设备文件，存取这个目录下面的某个文件，就等于存取某个设备。

- /etc

  存放系统主要的配置文件，例如用户账号和密码、各种服务的起始配置。

  一般来说，这个目录下的各文件属性是可以让一般使用者查阅的， 但是只有root有权力修改。FHS建议不要放置可可执行文件（binary）在这个目录中。

- /lib

  存放开机时会用到的函数库， 以及在/bin或/sbin下面的指令会调用的函数库。

- /media

  存放可移除的设备，例如软盘、光盘、DVD。

- /mnt

  暂时挂载某些额外的设备。

- /opt (option)

  给第三方协助软件放置的目录。

- /run

  存放开机后产生的各项信息。（原来是在/var/run）

- /sbin (system binary)

  只有root才能够利用的指令，来“设置”系统，其他使用者最多只能用来"查询"。例如开机、修复、还原系统所需要的指令。

  在其他目录下的sbin文件夹也是个存放一些比较"系统"的可执行文件，例如/usr/sbin中存放服务器软件、/usr/local/sbin存放用户自行安装的软件所产生的系统可执行文件。

- /srv (service)

  是一些网络服务启动之后，这些服务所需要取用的数据目录。例如WWW服务的数据就存放在/srv/www里。

  系统的服务数据如果尚未要提供给网际网络任何人浏览的话，默认还是建议放置到/var/lib。

- /tmp

  暂时放置文件的。

- /usr (Unix Software Resource)

  存放软件资源。

  这个目录有点类似Windows 系统的“C:\Windows\ （当中的一部份） + C:\Program files\”这两个目录的综合体，是所有系统默认的软件（distribution发布者提供的软件）都会放置到/usr下面。

- /var

  var就是在系统运行后才会渐渐占用硬盘容量的目录。

  /var目录主要针对常态性变动的文件，包括高速缓存（cache）、登录文件（log file）以及某些软件运行所产生的文件， 包括程序文件（lock file, run file），或者例如MySQL数据库的文件等等。



FHS定义出根目录（/）下面**可以存在**的目录：

- /home

  使用者主文件夹。例如用户叫hzs，则 ~ 代表就是/home/hzs文件夹。

- /lib<数字>

  存放与/lib不同格式的二进制函数库，例如支持64位的/lib64函数库。

- /root

  系统管理员的主文件夹。



一些根目录（/）下面的**其他常见**的目录：

- /lost+found

  使用标准的ext2/ext3/ext4文件系统格式才会产生的一个目录，目的在于当文件系统发生错误时， 将一些遗失的片段放置到这个目录下。

- /proc

  这个目录本身是一个“虚拟文件系统（virtual filesystem）”，他放置的数据都是在内存当中， 例如系统核心、行程信息（process）、周边设备的状态及网络状态等等。

- /sys

  这个目录其实跟/proc非常类似，也是一个虚拟的文件系统，主要也是记录核心与系统硬件信息较相关的信息。



#### /usr下面的目录

FHS要求必须存在的目录：

- /usr/bin

  所有一般用户能够使用的指令都放在这里。

  CentOS 7 已经将全部的使用者指令放置于此，而使用链接文件的方式将 /bin 链接至此！也就是说， **/usr/bin 与 /bin 是一模一样的**。

- /usr/lib

  /lib连接到这个，**/usr/lib与/lib是一模一样的**。

- /usr/local

  系统管理员在本机自行安装自己下载的软件（非distribution默认提供者），建议安装到此目录。

- /usr/sbin

  /sbin是系统正常运行时需要的系统指令，而/usr/sbin就存放一些某些网络服务器软件的服务指令。在CentOS 7中，**/usr/sbin与/sbin是一模一样的**。

- /usr/share

  存放只读的数据文件的，也包括共享文件，在这个目录下放置的数据几乎是不分硬件架构均可读取的数据。例如/usr/share/doc，/usr/share/man，/usr/share/zoneinfo(存放时区相关数据)



FHS建议可以存在的目录：

- /usr/games

  与游戏相关的数据存放处

- /usr/include

  C/C++等程序语言文件的header与include文件的放置处。

- /usr/libexec

  某些软件的可执行文件或脚本。

- /usr/lib<数字>

  在CentOS 7中，/lib<数字>和/usr/lib<数字>是一模一样的。

- /usr/src

  一般源代码建议放置到这里。至于核心源代码则建议放置到/usr/src/linux/目录下。

  PS：CentOS 7中这个目录为空0.0...



#### /var下面的目录

FHS要求必须存在的目录：

- /var/cache

  应用程序本身运行过程中会产生的一些暂存数据。

- /var/lib

  程序本身执行的过程中，需要使用到的数据文件放置的目录。在此目录下各自的软件应该要有各自的目录。 举例来说，MySQL的数据库放置到/var/lib/mysql/

- /var/lock

  某些设备或者是文件资源一次只能被一个应用程序所使用，如果同时有两个程序使用该设备时， 就可能产生一些错误的状况，因此就得要将该设备上锁（lock），以确保该设备只会给单一软件所使用。

  此目录目前已经链接到/run/lock中。

- /var/log （非常重要的目录）

  这是登录文件放置的目录！里面比较重要的文件如/var/log/messages, /var/log/wtmp（记录登陆者的信息）等。

- /var/mail

  存放个人电子邮件信箱的目录。

  此目录已经链接到/var/spool/mail中。

- /var/run

  这个文件已经链接到了/run中。一些程序启动后会将他们的PID存放到这个目录下。

- /var/spool

  这个目录通常放置一些伫列数据，所谓的“伫列”就是排队等待其他程序使用的数据，这些数据通常被使用后会被删除。



CentOS 7 比较大的差异在于将许多原本应该要在根目录（/）里面的目录，将他内部数据全部挪到/usr 里面去，然后进行链接设置。



#### 观察CentOS

使用uname指令查看主机Linux版本信息。

使用lsb_release查看主机Linux的LSB标准信息。（需要先通过yum安装redhat-lsb才行）



P291