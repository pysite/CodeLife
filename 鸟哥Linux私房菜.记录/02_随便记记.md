### 6.文件权限

在Linux里面，任何一个文件都具有“User, Group及Others”三种身份的个别权限。除此之外还有个“root”特殊角色。

Linux中所有的系统上的帐号与一般身份使用者，还有那个root的相关信息， 都是记录在/etc/passwd这个文件内。个人的密码则是记录在/etc/shadow这个文件下。，Linux所有的群组名称都记录在/etc/group内。

``su -``是切换到root用户的指令，``exit``即可退出root。



```shell
[root@study /]# ls -al
dr-xr-xr-x.  17 root root  224 9月   8 17:24 .
dr-xr-xr-x.  17 root root  224 9月   8 17:24 ..
lrwxrwxrwx.   1 root root    7 9月   8 17:21 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 9月   8 17:37 boot
drwxr-xr-x.  20 root root 3340 9月   9 12:53 dev
drwxr-xr-x. 144 root root 8192 9月   9 11:22 etc
drwxr-xr-x.   3 root root   17 9月   8 17:24 home
lrwxrwxrwx.   1 root root    7 9月   8 17:21 lib -> usr/lib
lrwxrwxrwx.   1 root root    9 9月   8 17:21 lib64 -> usr/lib64
drwxr-xr-x.   2 root root    6 4月  11 2018 media
```

上面代码中，lrwxrwxrwx这种是代表文件类型和文件权限的值，第一个字符是文件类型，剩下的字符三个一组"rwx"分别代表"文件拥有者", "群组", "其他人"三种用户对该文件的权限。

第一个字符：

1. 当为[ d ]则是目录；
2. 当为[ - ]则是文件；
3. 若是[ l ]则表示为链接文件（link file）；
4. 若是[ b ]则表示为设备文件里面的可供储存的周边设备（可随机存取设备）；
5. 若是[ c ]则表示为设备文件里面的序列埠设备，例如键盘、鼠标；
6. 若是[ s ]则表示为sockets文件；（后面再讲）
7. 若是[ p ]则表示为FIFO, pipe文件；（后面再讲）

PS：b是块设备文件，c是字符设备文件（例如鼠标，你不可能让鼠标“跳到”另一个画面，而是“连续性滑动”到另一个地方）

PS：目录和文件的权限意义不相同，目录的后面讲。



第二栏代表有多少文件名连接到此文件。第三栏是文件的拥有者，第四栏是群组，第五栏是文件大小(字节)，第六栏是文件创建日期或最近修改日期。最右边是文件名。

目录文件的如果[r--]，没有执行权限则无法进入此目录！

root非常特殊，即使文件的权限为[---------]，root也能存取这个文件。（最高权力）



#### 改变所属群组——chgrp

格式：``chgrp 目的群组名 文件名``

``-R``参数是指对目录下面的目录及文件也一同更改，一般用于改变整个目录权限时使用。



#### 改变文件拥有者——chown

格式：``chown 新账号[:群组名] 文件名``	改的时候可以顺便把群组也改了

chown也可以只改变群组名（加个小数点），``chown .群组名 文件名``



#### 改编权限——chmod

- 数字类型改变文件权限

  r是4，w是2，x1，如果是rwx就是4+2+1=7，如果是r-x就是4+1=5

  ```shell
  # 例如改为rwxrwxrwx，则
  chmod 777 文件名
  ```

- 符号类型改变文件权限

  u是拥有者，g是组，o是其他人，a是所有人，+是加权限，-是减权限，=是设置权限。

  ```shell
  # | chmod | u g o a | +（加入） -（除去） =（设置） | r w x | 文件或目录 |
  # 例如
  chmod u=rwx,go=rx 文件名
  ```

  

#### 目录文件的权限

对于目录文件来说，

- r表示读取目录结构清单的权限，可以查询该目录下的文件名数据。
- w表示具有异动该目录结构的权限，可以创建新文件/目录，可以删除，可以改名。
- x表示的是使用者能够进入该目录成为工作目录的用途。



如果一个用户对目录具有w权限，那么即使对目录中某个文件的权限是[---]，那么他也可以直接删除这个他完全无法利用的文件。

如果用户对一个目录只有x权限没有r权限，但用户知道这个目录有哪个文件，则该用户也可以直接对这个文件进行操作（把路径写出来就可）。

Linux的文件没有所谓"扩展名"，一个文件能否被执行只看是否有[x]的权限。

Linux文件长度限制，单一文件或目录的最大容许文件名为 255Bytes。

能否读取到某个文件内容，跟该文件所在的目录权限也有关系（目录至少需要有 x 的权限）。



### 7.Linux目录配置

#### Linux目录配置的依据——FHS

目录类型：

- 可分享的，可以分享给其他系统挂载使用的目录，所以包括可执行文件与使用者的邮件等数据， 是能够分享给网络上其他主机挂载用的目录。
- 不可分享的，仅仅与自己机器有关的文件。
- 不变的，跟随着distribution而不变动。 例如函数库、文件说明文档。

- 可变动的，经常改变的数据，例如登录文件、一般用户可自行收受的新闻群组等。



FHS针对目录树架构仅定义出三层目录下面应该放置什么数据：

- / （root, 根目录）：与开机系统有关；
- /usr （unix software resource）：与软件安装/执行有关；
- /var （variable）：与系统运行过程有关。



#### 根目录(/)

不但所有的目录都是由根目录衍生出来的，同时根目录也与开机/还原/系统修复等动作有关。所以FHS建议：**根目录（/）所在分区应该越小越好**， 且应用程序所安装的软件最好不要与根目录放在同一个分区内，保持根目录越小越好。

FHS定义出根目录（/）下面**必须要有**的目录：

- /bin

  存放cat, chmod, chown, date, mv, mkdir, cp, bash等等常用的指令。

  /bin放置的是在单人维护模式下还能够被操作的指令。 在/bin下面的指令可以被root与一般
  帐号所使用。

- /boot

  存放开机要使用的文件，例如Linux核心文件、开机配置文件等。

- /dev

  存放设备文件，存取这个目录下面的某个文件，就等于存取某个设备。

- /etc

  存放系统主要的配置文件，例如用户账号和密码、各种服务的起始配置。

  一般来说，这个目录下的各文件属性是可以让一般使用者查阅的， 但是只有root有权力修改。FHS建议不要放置可可执行文件（binary）在这个目录中。

- /lib

  存放开机时会用到的函数库， 以及在/bin或/sbin下面的指令会调用的函数库。

- /media

  存放可移除的设备，例如软盘、光盘、DVD。

- /mnt

  暂时挂载某些额外的设备。

- /opt (option)

  给第三方协助软件放置的目录。

- /run

  存放开机后产生的各项信息。（原来是在/var/run）

- /sbin (system binary)

  只有root才能够利用的指令，来“设置”系统，其他使用者最多只能用来"查询"。例如开机、修复、还原系统所需要的指令。

  在其他目录下的sbin文件夹也是个存放一些比较"系统"的可执行文件，例如/usr/sbin中存放服务器软件、/usr/local/sbin存放用户自行安装的软件所产生的系统可执行文件。

- /srv (service)

  是一些网络服务启动之后，这些服务所需要取用的数据目录。例如WWW服务的数据就存放在/srv/www里。

  系统的服务数据如果尚未要提供给网际网络任何人浏览的话，默认还是建议放置到/var/lib。

- /tmp

  暂时放置文件的。

- /usr (Unix Software Resource)

  存放软件资源。

  这个目录有点类似Windows 系统的“C:\Windows\ （当中的一部份） + C:\Program files\”这两个目录的综合体，是所有系统默认的软件（distribution发布者提供的软件）都会放置到/usr下面。

- /var

  var就是在系统运行后才会渐渐占用硬盘容量的目录。

  /var目录主要针对常态性变动的文件，包括高速缓存（cache）、登录文件（log file）以及某些软件运行所产生的文件， 包括程序文件（lock file, run file），或者例如MySQL数据库的文件等等。



FHS定义出根目录（/）下面**可以存在**的目录：

- /home

  使用者主文件夹。例如用户叫hzs，则 ~ 代表就是/home/hzs文件夹。

- /lib<数字>

  存放与/lib不同格式的二进制函数库，例如支持64位的/lib64函数库。

- /root

  系统管理员的主文件夹。



一些根目录（/）下面的**其他常见**的目录：

- /lost+found

  使用标准的ext2/ext3/ext4文件系统格式才会产生的一个目录，目的在于当文件系统发生错误时， 将一些遗失的片段放置到这个目录下。

- /proc

  这个目录本身是一个“虚拟文件系统（virtual filesystem）”，他放置的数据都是在内存当中， 例如系统核心、行程信息（process）、周边设备的状态及网络状态等等。

- /sys

  这个目录其实跟/proc非常类似，也是一个虚拟的文件系统，主要也是记录核心与系统硬件信息较相关的信息。



#### /usr下面的目录

FHS要求必须存在的目录：

- /usr/bin

  所有一般用户能够使用的指令都放在这里。

  CentOS 7 已经将全部的使用者指令放置于此，而使用链接文件的方式将 /bin 链接至此！也就是说， **/usr/bin 与 /bin 是一模一样的**。

- /usr/lib

  /lib连接到这个，**/usr/lib与/lib是一模一样的**。

- /usr/local

  系统管理员在本机自行安装自己下载的软件（非distribution默认提供者），建议安装到此目录。

- /usr/sbin

  /sbin是系统正常运行时需要的系统指令，而/usr/sbin就存放一些某些网络服务器软件的服务指令。在CentOS 7中，**/usr/sbin与/sbin是一模一样的**。

- /usr/share

  存放只读的数据文件的，也包括共享文件，在这个目录下放置的数据几乎是不分硬件架构均可读取的数据。例如/usr/share/doc，/usr/share/man，/usr/share/zoneinfo(存放时区相关数据)



FHS建议可以存在的目录：

- /usr/games

  与游戏相关的数据存放处

- /usr/include

  C/C++等程序语言文件的header与include文件的放置处。

- /usr/libexec

  某些软件的可执行文件或脚本。

- /usr/lib<数字>

  在CentOS 7中，/lib<数字>和/usr/lib<数字>是一模一样的。

- /usr/src

  一般源代码建议放置到这里。至于核心源代码则建议放置到/usr/src/linux/目录下。

  PS：CentOS 7中这个目录为空0.0...



#### /var下面的目录

FHS要求必须存在的目录：

- /var/cache

  应用程序本身运行过程中会产生的一些暂存数据。

- /var/lib

  程序本身执行的过程中，需要使用到的数据文件放置的目录。在此目录下各自的软件应该要有各自的目录。 举例来说，MySQL的数据库放置到/var/lib/mysql/

- /var/lock

  某些设备或者是文件资源一次只能被一个应用程序所使用，如果同时有两个程序使用该设备时， 就可能产生一些错误的状况，因此就得要将该设备上锁（lock），以确保该设备只会给单一软件所使用。

  此目录目前已经链接到/run/lock中。

- /var/log （非常重要的目录）

  这是登录文件放置的目录！里面比较重要的文件如/var/log/messages, /var/log/wtmp（记录登陆者的信息）等。

- /var/mail

  存放个人电子邮件信箱的目录。

  此目录已经链接到/var/spool/mail中。

- /var/run

  这个文件已经链接到了/run中。一些程序启动后会将他们的PID存放到这个目录下。

- /var/spool

  这个目录通常放置一些伫列数据，所谓的“伫列”就是排队等待其他程序使用的数据，这些数据通常被使用后会被删除。



CentOS 7 比较大的差异在于将许多原本应该要在根目录（/）里面的目录，将他内部数据全部挪到/usr 里面去，然后进行链接设置。



#### 观察CentOS

使用uname指令查看主机Linux版本信息。

使用lsb_release查看主机Linux的LSB标准信息。（需要先通过yum安装redhat-lsb才行）



### 8.目录与路径

> . 代表此层目录
> .. 代表上一层目录
> -代表前一个工作目录
> ~ 代表“目前使用者身份”所在的主文件夹
> ~account 代表 account 这个使用者的主文件夹（account是个帐号名称）

根目录的..就是自己。

``cd``不加任何就等同于``cd ~``

``pwd -P``是显示当前路径，如果是链接的，则会显示真正的那个目录所在地址。

``mkdir -p``是如果路径中的目录还未被创建，则会自动创建好。

``mkdir -m 权限`` 是为新建的目录赋予相应权限。

``rmdir -p``中-p的作用也是来删除中间层的目录。

``rmdir -r``中-r的作用是将目录下面的东西都删除。



#### $PATH

> 当我们在执行一个指令的时候，举例来说“ls”好了，系统会依照PATH的设置去每个PATH定义的目录下搜寻文件名为ls的可可执行文件， 如果在PATH定义的目录中含有多个文件名为ls的可执行文件，那么先搜寻到的同名指令先被执行！

``echo $PATH``查看自己电脑环境变量PATH的值。每个目录用冒号分隔。

往$PATH中添加新的写法：``PATH="${PATH}:/root"``



``cp -a``复制文件的所有属性，包括拥有者，创建时间。不加-a的话则会认为执行cp指令的用户是新文件的拥有者。

如果执行这个指令的用户本来就无法更改目标文件的拥有者、群组，则新文件也只是时间等属性有复制，其拥有者、群组无法复制，会是该用户自己。

``cp -r``复制目录及其中的文件。

``cp -l``创建硬链接。

``cp -s``创建软链接。

``cp -u``这个-u是update的意思，目标文件与来源文件有差异时，才会复制。

``cp -d``复制的是链接文件本身，如果不加-d，当复制链接文件时是复制其指向的那个真实文件。



``rm -rf``其中-r就是递归删除目录里面的文件，-f就是删除时忽略不存在的文件。

``mv -u``若目标文件已经存在，且 source 比较新，才会更新 （update）



``basename 绝对路径`` 获取绝对路径的最后一个文件的名字

``dirname 绝对路径`` 绝对路径除开最后一个文件名的字符串（上面的补）



### 9.文件内容查阅

``cat -n``查看的时候顺便加上行号。

``cat -A``会将[tab]以``^I``表示，会将断行符号用``$``表示。

``tac``就是``cat``反过来写，意思是从最后一行到第一行反向在屏幕上显示出来。

``nl`` 添加行号打印，和``cat -n``差不多，但比cat-n的功能更多。



``more 文件`` 按页来查看文件内容，还可以``/xxx``查找关键字``xxx``（按下``/``是开始输入的意思）

``less 文件`` 是more的进阶版，more只能向下翻页，less可以进行向上翻页，用``?``进行向上搜索等。



``head -n 100 文件`` 显示文件前100行

``head -n -100 文件`` 除开末尾100行的内容，其余全显示。

``tail -n 100 文件`` 显示文件最后100行

``tail -n +100 文件`` 除开开头99行的内容，其余全显示。（从100行开始）

``head -n 20 文件 | tail -n 10 `` 显示文件第11~20行的内容。

``cat -n /etc/man_db.conf | head -n 20 | tail -n 10`` 带行号地显示文件第11~20行内容。



``od -t c 文件`` 将文件以ASCII码读取。

``od -t x 文件`` 将文件以十六进制读取。



``ll``等于``ls -l``



#### 三种时间

mtime 内容数据变更的时间。

ctime 状态变更的时间，例如属性和权限变更。

atime 文件内容上次被取用的时间。



即使``cp -a``复制所有属性也不能复制ctime。

touch可以设置一个文件的时间（只能mtime和atime，不能ctime）。



### 10.文件与目录的默认权限和隐藏权限

#### 默认权限

``umask -S`` 查看当前用户创建文件的初始权限是怎样的。

``umask`` 查看umask的分数。分数指的是“该默认值需要减掉的权限！”。

```shell
[root@study ~]# umask
0022
# 看最后的3个数字，第一个数字是特殊权限用的
# 022代表777-022(或666-022)，因此新建的文件权限就是755 rwxr-xr-x
```

注意：文件的默认权限是666，目录的默认权限是777，因此在umask的值为022的条件下，新建一个目录的权限是755，新建一个普通文件的权限是644。

注意umask计算时不是简单的减法，例如6-3其实最后的结果是4，[rw-] - [-wx] = [r--] 

设置umask的方法就是``umask xxx``即可。



#### 隐藏权限

下面的``chattr``指令只能在Ext2/Ext3/Ext4的 Linux 传统文件系统上面完整生效， 其他的文件系统可能就无法完整的支持这个指令了，例如 xfs 仅支持部份参数而已。



``chattr [+-=] [ASacdistu] 文件``

a表示文件只加不减；

i表示文件不可被更动；



``lsattr`` 显示文件隐藏属性。



#### 文件特殊权限

- SUID

  ``-rwsr-xr-x``这种拥有者执行权限是``s``表示的意思是，这个文件在被其他用户执行时会暂时变为拥有者的身份。

  例如``/usr/bin/passwd``这个文件，拥有者是root，普通用户在执行这个文件时就会暂时变成root，而passwd的操作会去更改一些其他系统文件，因此普通用户就可以以root身份进行一些本来执行不了的动作。（passwd的本来意义是用户修改自己的密码，而Linux中用户密码都是存在/etc/shadow中，而这个文件的权限是[----------]的）

  SUID不会出现在目录中，只会对binary文件有效！

- SGID

  当``s``出现在第二组rwx中的x时就是SGID.

  SGID可以出现在文件或目录的权限中，意思是"执行者在执行的过程中将会获得该程序群组的支持！"

  **当一个目录设置了 SGID 的权限后，他将具有如下的功能**：若使用者在此目录下具有 w 的权限（可以新建文件），则使用者所创建的新文件，该新文件的群组与此目录的群组相同。

- SBIT

  当``t``出现在第三组rwx中的x时就是SBIT.

  SBIT只对目录有效，举例来说，我们的 /tmp 本身的权限是“drwxrwxrwt”， 在这样的权限内容下，任何人都可以在 /tmp 内新增、修改文件，但仅有该文件/目录创建者与 root 能够删除自己的目录或文件。



- 如何设置SUID\SGID\SBIT：

  4为SUID，2为SGID，1为SBIT。

  在原来3个数字前面加个数字，则此新的一个数字就代表特殊权限，例如：``-rwsr-xr-x``本来是``-rwxr-xr-x``为755，而x要变为s，因此要多个4，也就是``4755``。

- 注意：添加特殊权限之前一定要已经有``x``权限，否则加的``s``或``t``就会变为大写的``S``和``T``。



#### 观察文件类型

用``file``指令观察文件是ASCII还是data文件之类。



### 11.指令与文件的搜寻

#### 指令文件的搜寻

``which [-a] 指令``

例如，想查下当前系统中所有叫cat的指令的可执行文件位置``which -a cat``

PS：有些指令是bash代码内置的，不是某个文件，例如``history``。



#### 普通文件的搜寻

PS：尽量别用find（直接去搜寻硬盘，很慢）

``whereis``在一些特定的目录中寻找文件。

``locate``是根据“已创建的数据库 /var/lib/mlocate/” 里面的数据所搜寻的，CentOS 7.x 是每天更新数据库一次，因此可能会滞后。

``updatedb``根据 /etc/updatedb.conf 的设置去搜寻系统硬盘内的文件名，并更新/var/lib/mlocate 内的数据库文件。



``find PATH -mtime n`` 在路径PATH中查找n天前的那天被更改过的文件

``find PATH -mtime +n`` 在路径PATH中查找n天前（不含第n天）被更改过的文件

``find PATH -mtime -n`` 在路径PATH中查找n天之内（含第n天）被更改过的文件

mtime可换成atime/ctime

``find PATH -newer file`` 在路径PATH中查找比file更新的文件

``find PATH -nouser`` 找到无主的文件（无主的文件可能是由于之前被删除的用户创建的文件或者曾经以源代码自行编译软件时发生）

``find PATH -uid n`` 找到某个用户创建的文件

``find PATH -name '*httpd*'`` 找文件名包含 httpd 的文件

``find PATH -perm mode`` 找到文件权限刚好等于mode的文件

``find PATH -perm -mode`` 查找文件权限包含mode的文件

``find PATH -perm /mode`` 查找文件权限包含任一mode的文件

#### find额外可进行的动作

``find语句 -exec command`` 将find的结果作为参数执行后面的command。例如：

```shell
find /usr/bin /usr/sbin -perm /7000 -exec ls -l {} \;	
# \;是因为分号在shell中有特殊意义，因此这里用了转义符号。
```



