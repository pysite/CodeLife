- 自动记谱技术还可应用于音乐的知识表达和标注、音乐自动伴奏、音乐情感计算等领域；

- 音乐自动记谱分为音高识别、音符切分两部分；

- 国际通用的标准音高为每秒振动440次(即频率为440Hz)

  人耳可听到的声音频率范围是20Hz到20KHz。人耳对音高的感受存在一个最小可觉差，大约等于半音的百分之五。

- 音长是以全音符为基础进行划分的，其它各音符按它与全音符的比值命名，如二分音符、四分音符分别相当于全音符的二分之一、四分之一。
- 音强即音符的强弱，是人耳感知到的响度，它由声源振动**幅度**的大小决定
- 半音即两个相邻音级之间的高低关系，是音高关系的最小计量单位。钢琴上每两个相邻键之间都是半音关系。半音与半音之和称为“全音”。每两个相邻的半音的**频率之比**为2的1／12次方。

- 音程即两音之间在音高上的距离。音程的大小以度来衡量，指两个音之间包括半音和全音的个数。
- 复合音是由基音和泛音结合在一起形成的音，复合音的产生由于发声体在振动时，不仅整体在振动，它的部分同时也在振动。平时听到的声音，都不只是一个声音，一般都是由许多个音组合而成。

- 音乐的思想感情都是通过旋律表达出来的。

- 每一种乐器、不同的人以及所有发声体发出的声音，除了一个基音外，还有许多泛音伴随，正是这些泛音决定了其不同的音色， 使人能辨别出声源是何种类型。

- 一个**八度**就是频率翻倍，即2的1/12次方的12次方，即12个音（10个全音，2个半音）



- 哼唱表演与期望哼唱音符的音高往往存在着有意的和无意的偏差。

- 颤音，均值接近于被感知的音符音高。一条颤抖的曲线。

- 滑音，就是一条斜线。



- 人对一个复合音的音高感知，当一个声波重复特性相似的一个波形时，人们能够听到清晰的音高，而且这种感知通过多个与基频成整数倍的倍频成分得以巩固。

- 人们感知音高的方法大都通过关系，通过度量两个音高在感知上的差别来得到音高间的距离。“相对音感“



- WAV文件存储的原始音乐的采样信息，一种无损的音频文件格式。RIFF格式

  WAV文件采用PCM编码，将声音等模拟信号变成符号化的脉冲列，再予以记录。

  采样位数，一般有8位和16位之分，8位不是说把**纵坐标分成**8份，而是分成2的8次方即256份。

  采样频率，每秒钟取得声音样本的次数。

- MIDI不传送音频波形，它是一个协议，只包含用于产生特定声音的指令。

  譬如在某个时刻，使用什么乐器，以什么音符开始，以什么音调结束，加以什么伴奏等。

  MIDI音高一般在50到80



### 信号加窗

- 两帧之间存在重叠，重叠部分称为帧移，一般为窗长的一半。

- 常用的窗函数有矩形窗、汉明窗、汉宁窗等。

- 矩形窗的平滑性较好，一般用于计算短时能量和平均幅度；汉**明**窗保留了高频部分和波形的细节，一般用于信号的频谱分析；汉**宁**窗保留了振幅曲线中的突变，还常用在信号包络的提取中。
  - 电音智造选择的是汉明窗。

- 窗口太大就不能反映波形变化的细节；窗口太小则不能得到较为平滑的短时信息；



### 音乐信号分析

> 时域分析，对以时间为自变量的二维矩阵进行分析

- **短时能量**是指在一个短时信号帧内采样点所聚集的平均能量。

- **短时平均过零率**是指在一个短时信号帧内信号通过零值的次数，即离散采样信号值由正到负和由负到正变化的的次数。

  音乐信号不是简单的正弦序列，所以平均过零率的方法不那么确切，但 仍可获得频谱特征的粗略估计。

> 频域分析

- 傅里叶频谱分析，在实际计算中，一般用离散傅里叶变换代替连续傅里叶变换；



### 音乐基频提取算法

> 自相关算法

- 传统的频率测量算法之一是自相关法，例如一段向量[1,0,1,0,1,0]我们一看就知道这段信号的周期就是2，即v[i] = v[i+2]，因此就可以认为频率为1/deltaT = 1/2；

  自相关法就是通过发现[1,0,1,0,1,0]x[0,1,0,1,0,1] = 0而[1,0,1,0,1,0]x[1,0,1,0,1,0]  = 3发现当延迟为2时自相关内积最大，因此可以认为周期就是2个；

- 自相关函数在信号周期的整数倍上出现最大值，因而可以从第一个最大值的位置估算出信号的基音周期。



>  YIN算法

- 就是例如[1,0,1,0]，取延迟为1，则差函数的值为(1-0)^2 + (0-1)^2 + (1-0)^2 + (0-1)^2 = 4

  而如果取延迟为2，则差函数的值为(1-1)^2 + (0-0)^2 + (1-1)^2 = 0

  因此取差函数值最小时的延迟为信号周期

- YIN算法的思想是将上述差函数值累加起来为sum，每求出一个新的差函数X，就用

  新X = X / ((1/n) x sum)

  这样做避免了高频信号无法估计的弊端，就相当于更好了一些。

- YIN算法还对新的差函数的值设置了一些阈值，例如有多个差函数值都小于了0.2，则YIN算法会选择最小的一个延迟（该延迟不一定是差函数最小的，只是它的延迟是最小的）作为周期，而如果都大于了0.2，则YIN算法会选择使差函数最小的延迟作为周期。

- YIN算法通过前面运算得到一个延迟值后会在(延迟-1, 延迟+1)范围内采用抛物线插值方法寻找函数最小值对应的延迟；即在延迟附近的范围内进一步找较小差函数值的方法来得到高精度的基频特征；



> 倍音列算法

- 采用快速傅里叶变换（离散傅里叶变换的一种快速算法）；
- 快速傅里叶变换得到的最大峰值并非总是对应正确的音高，有时最大的可能是其3倍音或者5倍音。由于乐音中有着丰富的谐波信息，而且音高范围跨度比较大，很有可能将其2倍音或者3倍音误判为音高。

- **能量最大值所对应的频率一定会是基频的某个倍音**；

- 把1倍、2倍...m倍的频率的能量加到一起算作该频率的能力；

  上述方法则可以得到一个较为粗略的音高估计；



### 音符切分

- 一个典型音符包含滑音前驱、稳定音区、音符后继（气声）

- 先检测稳定音区，再在稳定音区之间对未识别部分进行颤音/滑音识别，最后将识别出来的不同区域合并为一个音符，得到确定边界的音符序列；



> 气声

- 气声大多出现在一小节或者一句哼唱的结束位置，因此气声的判定可以直接作为音符边界的证据。

- 气声信号的周期性不明显，因此气声的识别可以采用与基频提取类似的算法；

  意思就是用前面的自相关法或者YIN算法计算出的值越不像一个音符，即看起来这段音乐不存在音符，就认为是气声。

- 若是使用基因列模型进行气声识别，则认为如果该帧的识别出的MIDI音高超过一定的区间，该信号帧就被认定为气声。（论文中用的也是这个方法，就是把看起来不像音符的区间认为是气声）



> 稳定音区

- 就是一段区间的最大音高和最小音高在一个半音内就可以认为是一个稳定音区。
- 在两个稳定音区之间，找到最后一个气声帧，将其之前的帧全部归并到前面的帧，将其后面的帧归为下一个音符。



> 基于能量的音符切分算法

- 基于能力主要是避免两个具有相同音高的连续音符在哼唱表演中被同时演唱，而仅依据音高变化的音符切分会造成两个音符的合并。

- 由于信号的能量通常集中在低频部分，而对于连续音符构成的哼唱信号，其引发能量显著变化的瞬态却存在于高频部分。

  提出了HFC(High Frequency Content)检测函数，计算能量时加入线性权重以提高高频部分的能量；（就是对于一帧中的各个频率的能量值乘以个权重k，k就是这个频率的下标，因此频率越高k越大，最后之和作为这一阵的能量）

  （可以选择作为能量检测函数有三个）

- 第二种检测函数是将前后两帧中对应相同频率的能量值的平方之差的绝对值进行累加。

- 第三种检测函数略。



> 检测函数去伪峰值

- 计算局部能量均值，再判断该点的能量值是否大于该局部均值，大于就认为是一个onset。



> 组合判定函数对两种切分方法得到的区间进行整合

- 首先是区间长度要大于一个阈值；

- 采用双向延申的方法将未归类的零散帧和气声帧归并到相邻的稳定音区或颤音区；



### 音调识别的有待改进点

只是单纯地对原来语音进行识别，未结合相关乐理知识对音调进行进一步准确的识别，例如可以识别出是哪一种调式、风格、旋律，再对音调进行微调。

